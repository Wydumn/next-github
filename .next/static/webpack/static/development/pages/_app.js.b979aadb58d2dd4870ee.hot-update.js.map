{"version":3,"file":"static/webpack/static\\development\\pages\\_app.js.b979aadb58d2dd4870ee.hot-update.js","sources":["webpack:///./components/Layout.jsx"],"sourcesContent":["import { useState, useCallback } from 'react'\r\nimport getConfig from 'next/config'\r\nimport { connect } from 'react-redux'\r\nimport { withRouter, Router } from 'next/router'\r\n\r\nimport axios from 'axios'\r\n\r\nimport { Layout, Avatar, Icon, Input, Tooltip, Dropdown, Menu } from 'antd'\r\nimport Container from './Container'\r\nimport { logout } from '../store/store'\r\nimport Link from 'next/link'\r\n\r\nconst { Header, Content, Footer } = Layout\r\n\r\nconst { publicRuntimeConfig } = getConfig()\r\n\r\nconst githubIconStyle = {\r\n    color: 'white',\r\n    fontSize: 40,\r\n    display: 'block',\r\n    paddingTop: 10,\r\n    paddingRight: 20,\r\n}\r\n\r\nexport const footerStyled = {\r\n    textAlign: 'center'\r\n}\r\n\r\nfunction MyLayout ({ children, user, logout, router }) {\r\n    const urlQuery = router.query && router\r\n    \r\n    const [search, setSearch] = useState('')\r\n\r\n    const handleSearchChange = useCallback(event => {\r\n        setSearch(event.target.value)\r\n    }, [setSearch])\r\n    \r\n    const handleOnSearch = useCallback(() => {\r\n        Router.push(`/search?query=${search}`)\r\n    }, [search])\r\n    \r\n    const handleLogout = useCallback(() => {\r\n        logout()\r\n    }, [logout])\r\n\r\n    const handleGotoOAuth = useCallback(e => {\r\n        e.preventDefault()  // 组织跳转\r\n\r\n        // asPath - 展现在浏览器上的实际路径，包含查询内容，为String类型\r\n        axios.get(`/prepare-auth?url=${router.asPath}`).\r\n            then(res => {\r\n                if (res.status === 200) {\r\n                    location.href = publicRuntimeConfig.OAUTH_URL\r\n                } else {\r\n                    console.log('prepare auth failed', res)\r\n                }\r\n            }).catch(err => {\r\n                console.log('prepare auth failed', err)\r\n            })\r\n    }, [])\r\n\r\n    const userDropDown = (\r\n        <Menu>\r\n            <Menu.Item>\r\n                <a href='javascript:void(0)' onClick={handleLogout}>\r\n                    登出\r\n                </a> \r\n            </Menu.Item>\r\n        </Menu>\r\n    )\r\n\r\n    return (\r\n        <Layout>\r\n            <Header>\r\n                <Container render={<div className=\"header-inner\"/>}>\r\n                <div className=\"header-left\">\r\n                    <div className='logo'>\r\n                        <Link href='/'>\r\n                            <Icon type=\"github\" style={githubIconStyle} />\r\n                        </Link>\r\n                    </div>\r\n                    <div>\r\n                        <Input.Search\r\n                            placeholder='搜索仓库'\r\n                            value={search}\r\n                            onChange={handleSearchChange}\r\n                            onSearch={handleOnSearch}\r\n                        />\r\n                    </div>\r\n                </div>\r\n                <div className='header-right'>\r\n                    <div className=\"user\">\r\n                        {\r\n                            user && user.id ? (\r\n                                <Dropdown overlay={userDropDown}>\r\n                                    <a href=\"/\">\r\n                                        <Avatar size={40} src={user.avatar_url} />\r\n                                    </a>\r\n                                </Dropdown>\r\n                                \r\n                            ) : (\r\n                                <Tooltip title=\"点击进行登录\">\r\n                                    <a href={`/prepare-auth?url=${router.asPath}`}>\r\n                                        <Avatar size={40} icon=\"user\" />\r\n                                    </a>\r\n                                </Tooltip>\r\n                            )\r\n                        }\r\n                    </div>\r\n                </div>\r\n                </Container>\r\n            </Header>\r\n            <Content>\r\n                <Container>{children}</Container>\r\n            </Content>\r\n            <Footer style={footerStyled}>\r\n                Develop by wydumn\r\n            </Footer>\r\n            <style jsx>{`\r\n                .header-inner {\r\n                    display: flex;\r\n                    justify-content: space-between;\r\n                }\r\n                .header-left {\r\n                    display: flex;\r\n                    justify-content: flex-start;\r\n                }   \r\n            `}</style>\r\n            <style jsx global>{`\r\n                #__next {\r\n                    height: 100%;\r\n                }\r\n                .ant-layout {\r\n                    min-height: 100%;\r\n                }\r\n                .ant-layout-header {\r\n                    padding-left: 0;\r\n                    padding-right: 0;\r\n                }\r\n                .ant-layout-content {\r\n                    background: #fff;\r\n                }\r\n            `}</style>\r\n        </Layout>\r\n    )\r\n}\r\n\r\nexport default connect(function mapStateToProps(state) {\r\n    return {\r\n        user: state.user\r\n    }\r\n}, function mapDispatchToProps(dispatch) {\r\n    return {\r\n        logout: () => dispatch(logout())\r\n    }\r\n})(withRouter(MyLayout))\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAQA;AACA;AADA;AACA;AAGA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AACA;AAIA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAAA;AAAA;AACA;AAMA;AAGA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAGA;AAAA;AAEA;AACA;AACA;AACA;AAJA;AAQA;AAAA;AACA;AAAA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAKA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAYA;AAAA;AA3CA;AAAA;AAAA;AAAA;AAyEA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AAAA;AAAA;AADA;AAGA;;;;A","sourceRoot":""}